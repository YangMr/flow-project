import{o as e,c as a,w as l,l as t,d as s,f as r,e as n,t as c,m as i,n as u,A as d,g as o,i as _,r as f,u as v,a as g,F as p,b as h,h as y,S as m,j as k,v as b}from"./index-3a6de0df.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";import{a as w,o as C,r as S}from"./uni-fetch.7884c55d.js";import{_ as $,a as F}from"./uni-list.2ecd7b55.js";const j=x({name:"UniCard",emits:["click"],props:{title:{type:String,default:""},subTitle:{type:String,default:""},padding:{type:String,default:"10px"},margin:{type:String,default:"15px"},spacing:{type:String,default:"0 10px"},extra:{type:String,default:""},cover:{type:String,default:""},thumbnail:{type:String,default:""},isFull:{type:Boolean,default:!1},isShadow:{type:Boolean,default:!0},shadow:{type:String,default:"0px 0px 3px 1px rgba(0, 0, 0, 0.08)"},border:{type:Boolean,default:!0}},methods:{onClick(e){this.$emit("click",e)}}},[["render",function(f,v,g,p,h,y){const m=d,k=o,b=_;return e(),a(k,{class:u(["uni-card",{"uni-card--full":g.isFull,"uni-card--shadow":g.isShadow,"uni-card--border":g.border}]),style:i({margin:g.isFull?0:g.margin,padding:g.spacing,"box-shadow":g.isShadow?g.shadow:""})},{default:l((()=>[t(f.$slots,"cover",{},(()=>[g.cover?(e(),a(k,{key:0,class:"uni-card__cover"},{default:l((()=>[s(m,{class:"uni-card__cover-image",mode:"widthFix",onClick:v[0]||(v[0]=e=>y.onClick("cover")),src:g.cover},null,8,["src"])])),_:1})):r("",!0)]),!0),t(f.$slots,"title",{},(()=>[g.title||g.extra?(e(),a(k,{key:0,class:"uni-card__header"},{default:l((()=>[s(k,{class:"uni-card__header-box",onClick:v[1]||(v[1]=e=>y.onClick("title"))},{default:l((()=>[g.thumbnail?(e(),a(k,{key:0,class:"uni-card__header-avatar"},{default:l((()=>[s(m,{class:"uni-card__header-avatar-image",src:g.thumbnail,mode:"aspectFit"},null,8,["src"])])),_:1})):r("",!0),s(k,{class:"uni-card__header-content"},{default:l((()=>[s(b,{class:"uni-card__header-content-title uni-ellipsis"},{default:l((()=>[n(c(g.title),1)])),_:1}),g.title&&g.subTitle?(e(),a(b,{key:0,class:"uni-card__header-content-subtitle uni-ellipsis"},{default:l((()=>[n(c(g.subTitle),1)])),_:1})):r("",!0)])),_:1})])),_:1}),s(k,{class:"uni-card__header-extra",onClick:v[2]||(v[2]=e=>y.onClick("extra"))},{default:l((()=>[s(b,{class:"uni-card__header-extra-text"},{default:l((()=>[n(c(g.extra),1)])),_:1})])),_:1})])),_:1})):r("",!0)]),!0),s(k,{class:"uni-card__content",style:i({padding:g.padding}),onClick:v[3]||(v[3]=e=>y.onClick("content"))},{default:l((()=>[t(f.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),s(k,{class:"uni-card__actions",onClick:v[4]||(v[4]=e=>y.onClick("actions"))},{default:l((()=>[t(f.$slots,"actions",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}],["__scopeId","data-v-64011453"]]),I=(e,a=1,l=5)=>w.get("/driver/messages/page",{contentType:e,page:a,pageSize:l}),R=e=>w.put(`/driver/messages/readAll/${e}`),T=x({__name:"notify",setup(t){const i=f(!1),d=f("201"),k=f(0),b=f(5),x=f([]),w=f(!1),$=f(!1),F=async()=>{console.log("123");try{k.value+=1;const e=await I(d.value,k.value,b.value);1===k.value&&(x.value=[]),x.value=[...x.value,...e.data.items||[]],console.log("result",e),w.value=k.value==e.data.pages,i.value=0===x.value.length}catch(e){console.log(e)}};C((()=>{F()}));const T=()=>{w.value||F()},B=async()=>{$.value=!0,k.value=0,await F(),$.value=!1},A=async()=>{try{await R(d.value);k.value=0,F()}catch(e){console.log(e)}};return(t,d)=>{const f=_,k=o,b=y,C=S(v("uni-card"),j),F=m;return e(),a(F,{"refresher-triggered":$.value,onRefresherrefresh:B,"refresher-enabled":"",onScrolltolower:T,"scroll-y":"true",class:"scroll-view","refresher-background":"#f4f4f4;"},{default:l((()=>[s(k,{class:"scroll-view-wrapper"},{default:l((()=>[s(k,{onClick:A,class:"message-action"},{default:l((()=>[s(f,{class:"iconfont icon-clear"}),n(" 全部已读 ")])),_:1}),(e(!0),g(p,null,h(x.value,((t,r)=>(e(),a(C,{"is-shadow":!1,key:r},{title:l((()=>[s(k,{class:u([{unread:0===t.isRead},"title"])},{default:l((()=>[n(c(t.title),1)])),_:2},1032,["class"])])),default:l((()=>[s(k,{class:"brief"},{default:l((()=>[n(c(t.content),1)])),_:2},1024),s(k,{class:"extra"},{default:l((()=>[s(f,{class:"time"},{default:l((()=>[n(c(t.created),1)])),_:2},1024),s(b,{class:"link",url:"/subpkg_message/content/index"},{default:l((()=>[n("查看详情")])),_:1})])),_:2},1024)])),_:2},1024)))),128)),w.value?(e(),a(k,{key:0,class:"tips"},{default:l((()=>[n("已经到达底部了~")])),_:1})):r("",!0)])),_:1}),i.value?(e(),a(k,{key:0,class:"message-blank"},{default:l((()=>[n("暂无消息")])),_:1})):r("",!0)])),_:1},8,["refresher-triggered"])}}},[["__scopeId","data-v-d1c5413d"]]),B=x({__name:"announce",setup(t){const c=f(!1),i=f(!1),u=f({}),d=f([]),y=f(0),k=f(5),b=f(!1),x=f("200"),w=async()=>{try{y.value+=1;const e=await I(x.value,y.value,k.value);1===y.value&&(d.value=[]),u.value=e.data,d.value=[...d.value,...e.data.items||[]],i.value=y.value==u.value.pages,c.value=0===d.value.length}catch(e){console.log(e)}};C((()=>{w()}));const j=()=>{i.value||w()},T=async()=>{b.value=!0,y.value=0,await w(),b.value=!1},B=async()=>{try{await R(x.value);y.value=0,w()}catch(e){console.log(e)}};return(t,i)=>{const u=_,f=o,y=S(v("uni-list-item"),$),k=S(v("uni-list"),F),x=m;return e(),a(x,{"refresher-triggered":b.value,onRefresherrefresh:T,"refresher-enabled":"",onScrolltolower:j,"scroll-y":"true",class:"scroll-view","refresher-background":"#f4f4f4;"},{default:l((()=>[d.value.length>0?(e(),a(f,{key:0,class:"scroll-view-wrapper"},{default:l((()=>[s(f,{onClick:B,class:"message-action"},{default:l((()=>[s(u,{class:"iconfont icon-clear"}),n(" 全部已读 ")])),_:1}),s(k,null,{default:l((()=>[(e(!0),g(p,null,h(d.value,((t,s)=>(e(),a(y,{key:t.id,title:t.title,"right-text":t.created,ellipsis:"1",to:`/subpkg_message/content/index?id=${t.id}`},{header:l((()=>[0===t.isRead?(e(),a(u,{key:0,class:"dot"})):r("",!0)])),_:2},1032,["title","right-text","to"])))),128))])),_:1})])),_:1})):r("",!0),c.value?(e(),a(f,{key:1,class:"message-blank"},{default:l((()=>[n("暂无消息")])),_:1})):r("",!0)])),_:1},8,["refresher-triggered"])}}},[["__scopeId","data-v-bf0c5ecb"]]),A=x({__name:"index",setup(t){const i=f(0),d=f([{title:"任务通知",rendered:!0},{title:"公告",rendered:!1}]);return(t,_)=>{const f=o;return e(),a(f,{class:"page-container"},{default:l((()=>[s(f,{class:"tab"},{default:l((()=>[(e(!0),g(p,null,h(d.value,((t,r)=>(e(),a(f,{onClick:e=>(e=>{d.value[e].rendered=!0,i.value=e})(r),class:"tab-item",key:r},{default:l((()=>[s(f,{class:u(["title",{active:i.value===r}])},{default:l((()=>[n(c(t.title),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1}),d.value[0].rendered?k((e(),a(f,{key:0,class:"message-list"},{default:l((()=>[s(T)])),_:1},512)),[[b,0===i.value]]):r("",!0),d.value[1].rendered?k((e(),a(f,{key:1,class:"message-list"},{default:l((()=>[s(B)])),_:1},512)),[[b,1===i.value]]):r("",!0)])),_:1})}}},[["__scopeId","data-v-22e904b6"]]);export{A as default};
