import{a3 as e,a4 as t,a5 as s,a6 as a,a7 as n,a8 as r,a9 as i,aa as o,ab as u,r as c,ac as d,y as l}from"./index-3a6de0df.js";function p(e,t){return a(e)?t:e}const g=(s=>(a,r=t())=>{!n&&e(s,a,r)})(s);var h={};Object.defineProperty(h,"__esModule",{value:!0});var v=h.createUniFetch=void 0;function b(e){var t,s;const a=[],n=e=>(!e.url.startsWith("http")&&n.baseURL&&(e.url=n.baseURL+e.url),n.intercept.request(e),(null==n?void 0:n.loading)&&!a.length&&r(Object.assign({},n.loading)),a.push("loading"),new Promise(((t,s)=>{i(Object.assign(Object.assign({},e),{success:s=>{t(n.intercept.response(Object.assign(Object.assign({},s),{config:e})))},fail:s,complete:()=>{a.pop(),a.length||o()}}))})));return n.loading=null==e?void 0:e.loading,n.baseURL=null==e?void 0:e.baseURL,n.intercept={request:e=>e,response:e=>e},(null===(t=null==e?void 0:e.intercept)||void 0===t?void 0:t.request)&&(n.intercept.request=e.intercept.request),(null===(s=null==e?void 0:e.intercept)||void 0===s?void 0:s.response)&&(n.intercept.response=e.intercept.response),n.get=function(e,t={}){return n({url:e,method:"GET",data:t})},n.post=function(e,t={}){return n({url:e,method:"POST",data:t})},n.put=function(e,t={}){return n({url:e,method:"PUT",data:t})},n.delete=function(e,t){return n({url:e,method:"DELETE",data:t})},n}v=h.createUniFetch=b,h.default=b();const f=u("user",(()=>({token:c("")})),{persist:!0}),m=["pages/task/index","pages/message/index","pages/my/index"],U=v({loading:{title:"加载中..."},baseURL:"/dev-api",intercept:{request(e){const t={Authorization:f().token};return e.header=Object.assign({},t,e.header),e},response(e){if(200===e.statusCode&&200===e.data.code)return e.data;if(401===e.statusCode){const e=d();console.log("pageStack",e);const t=e[e.length-1].route,s=m.includes(t)?"switchTab":"redirectTo";return l({url:`/pages/login/index?routeType=${s}&redirectUrl=/${t}`})}uni.utils.toast(e.data.msg||"请求失败")}}});export{U as a,g as o,p as r,f as u};
